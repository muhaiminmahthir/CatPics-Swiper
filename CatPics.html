<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Paws & Preferences : Find Your Favourite Kitty</title>
  <meta name="description" content="Swipe right for like, left for nope. A tiny, mobile-first cat preference app powered by CATAAS." />
  <style>
    :root {
      --bg: #0b0d10;
      --card: #12151a;
      --text: #e7ecf3;
      --sub: #9aa7b5;
      --accent: #7dd3fc;
      --like: #22c55e;
      --nope: #ef4444;
      --muted: #1b2027;
      --ring: rgba(125, 211, 252, 0.5);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 70% -10%, #13212c 0%, var(--bg) 50%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .wrap { display: grid; grid-template-rows: auto 1fr auto; min-height: 100%; }
    header {
      display: flex; align-items: center; justify-content: center; gap: .75rem;
      padding: 1rem 1.25rem; position: sticky; top: 0; background: linear-gradient(to bottom, rgba(11,13,16,.95), rgba(11,13,16,.6), rgba(11,13,16,0)); backdrop-filter: blur(6px);
    }
    header .dot { width: .65rem; height: .65rem; border-radius: 999px; background: var(--accent); box-shadow: 0 0 0 .25rem var(--ring); }
    header h1 { margin: 0; font-size: 1.05rem; letter-spacing: .2px; font-weight: 650; }
    header .sub { font-size: .85rem; color: var(--sub); }

    main { display: grid; place-items: center; padding: 0 1rem 1rem; }
    .deck {
      width: min(560px, 100%);
      aspect-ratio: 3/4.2;
      position: relative;
      touch-action: pan-y;
      user-select: none;
    }
    .card {
      position: absolute; inset: 0; background: var(--card); border-radius: 24px; overflow: hidden; box-shadow: 0 15px 60px rgba(0,0,0,.35);
      display: grid; grid-template-rows: 1fr auto; border: 1px solid rgba(255,255,255,.07);
      transform-origin: 50% 80%;
      transition: box-shadow .25s ease;
    }
    .card img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card .meta { display: flex; justify-content: space-between; align-items: center; padding: .75rem .9rem; background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,0)); }
    .card .meta .label { font-size: .85rem; color: var(--sub); }

    .ghost { position: absolute; inset: 0; pointer-events: none; border-radius: 24px; display: grid; place-items: start; padding: 1rem; }
    .badge { padding: .35rem .55rem; border-radius: 8px; font-weight: 700; letter-spacing: .6px; font-size: .8rem; border: 2px solid; transform: rotate(-12deg); opacity: 0; }
    .badge.like { color: var(--like); border-color: var(--like); background: rgba(34,197,94,.08); }
    .badge.nope { color: var(--nope); border-color: var(--nope); background: rgba(239,68,68,.08); transform: rotate(12deg); justify-self: end; }

    .controls { display: grid; grid-template-columns: 1fr auto 1fr; gap: .75rem; align-items: center; width: min(560px, 100%); margin-top: 1rem; }
    .progress { height: 6px; background: var(--muted); border-radius: 999px; overflow: hidden; }
    .progress > i { display: block; height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), #60a5fa); transition: width .25s ease; }

    .btns { display: flex; gap: .75rem; justify-content: center; }
    button {
      appearance: none; border: 0; padding: .9rem 1.1rem; border-radius: 14px; font-weight: 700; cursor: pointer; background: var(--muted); color: var(--text);
      box-shadow: 0 6px 18px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.06);
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,.3); }
    button:active { transform: translateY(0); }
    .primary { background: linear-gradient(180deg, #1f2937, #111827); }

    .like { background: rgba(34,197,94,.12); color: #86efac; }
    .nope { background: rgba(239,68,68,.12); color: #fca5a5; }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    .summary { width: min(720px, 100%); display: none; }
    .summary h2 { margin: .25rem 0 0; font-size: 1.25rem; }
    .summary p { color: var(--sub); margin-top: .25rem; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: .5rem; margin-top: 1rem; }
    .grid img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 12px; border: 1px solid rgba(255,255,255,.08); }

    footer { padding: 1.25rem; text-align: center; color: var(--sub); font-size: .85rem; }

    @media (min-width: 520px) {
      .grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <i class="dot" aria-hidden="true"></i>
      <h1>Paws & Preferences</h1>
      <span class="sub">Swipe right to like, left to nope</span>
    </header>

    <main>
    <!-- Deck empty, js will inject cats -->
      <section class="deck" id="deck" aria-live="polite" aria-label="Cat deck"></section>

      <div class="controls">
        <div class="progress" aria-hidden="true"><i id="bar"></i></div>
        <div class="btns" role="group" aria-label="Actions">
          <button id="nopeBtn" class="nope" title="Nope (Left Arrow)">Nope</button>
          <button id="likeBtn" class="like" title="Like (Right Arrow)">Like</button>
        </div>
        <div style="opacity:.6; text-align:right; font-feature-settings: 'tnum' 1; font-variant-numeric: tabular-nums;" id="count">0/0</div>
      </div>

      <section class="summary" id="summary">
        <h2 id="resultTitle">Summary</h2>
        <p id="resultText"></p>
        <div class="grid" id="likedGrid"></div>
        <div class="btns" style="margin-top: .75rem;">
          <button class="primary" id="tryAgain">Try another batch</button>
        </div>
      </section>
    </main>

    <footer>
      Powered by <a href="https://cataas.com" target="_blank" rel="noopener" style="color: var(--accent); text-decoration: none;">CATAAS</a>. Built for a coding exercise.
    </footer>
  </div>

  <script>
    // 1. fetchCat() ask CATAAS API for JSON
    // 2. builds image URLs
    // 3. load() call fetchCats() the call createCard() for each URL
    // 4. createCard() makes card and injects img

    const BATCH_SIZE = 14;
    const IMG_WIDTH = 900;

    let photos = [];
    let index = 0;
    const liked = [];
    const disliked = [];

    const deck = document.getElementById('deck');
    const bar = document.getElementById('bar');
    const countEl = document.getElementById('count');
    const likeBtn = document.getElementById('likeBtn');
    const nopeBtn = document.getElementById('nopeBtn');
    const summary = document.getElementById('summary');
    const likedGrid = document.getElementById('likedGrid');
    const resultTitle = document.getElementById('resultTitle');
    const resultText = document.getElementById('resultText');
    const tryAgain = document.getElementById('tryAgain');

    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    // 1. fetch a list of cats
    async function fetchCats(n) {
      try {
        const res = await fetch(`https://cataas.com/api/cats?limit=${n}`, { cache: 'no-store' });
        if (!res.ok) throw new Error('API error');
        const list = await res.json();
        if (!Array.isArray(list) || list.length === 0) throw new Error('Empty');
        return list.slice(0, n).map(x => `https://cataas.com/cat/${encodeURIComponent(x._id || x.id)}?width=${IMG_WIDTH}`);
      } catch (e) {
        const seed = Date.now();
        return Array.from({ length: n }, (_, i) => `https://cataas.com/cat?width=${IMG_WIDTH}&r=${seed}-${i}`);
      }
    }

    // 2. preload image is for smooth experience
    function preload(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.decoding = 'async';
        img.loading = 'eager';
        img.src = src;
        img.onload = () => resolve(src);
        img.onerror = reject;
      });
    }

    // 3. main load fx
    async function load() {
      photos = await fetchCats(BATCH_SIZE);
      index = 0; liked.length = 0; disliked.length = 0;
      deck.innerHTML = '';
      summary.style.display = 'none';

      const preloadCount = Math.min(3, photos.length);
      await Promise.all(photos.slice(0, preloadCount).map(preload));

      // Inject card for each cat into deck
      photos.forEach((src, i) => {
        const card = createCard(src, i);
        deck.appendChild(card);
      });

      updateProgress();
      bindButtons();
      photos.slice(preloadCount).forEach(src => preload(src).catch(() => {}));
    }

    //this fx create card element with <img>
    function createCard(src, i) {
      const card = document.createElement('article');
      card.className = 'card';
      
      const img = document.createElement('img');
      img.alt = 'Cat photo';
      img.src = src; // cat pic is set here

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.innerHTML = `<span class="label">Cat ${i + 1}</span><span class="label">${i + 1} / ${BATCH_SIZE}</span>`;

      const ghost = document.createElement('div');
      ghost.className = 'ghost';
      const likeBadge = document.createElement('div');
      likeBadge.className = 'badge like';
      likeBadge.textContent = 'LIKE';
      const nopeBadge = document.createElement('div');
      nopeBadge.className = 'badge nope';
      nopeBadge.textContent = 'NOPE';
      ghost.appendChild(likeBadge);
      ghost.appendChild(nopeBadge);

      card.append(img, ghost, meta);

      makeDraggable(card, src, likeBadge, nopeBadge);
      return card;
    }

    function makeDraggable(card, src, likeBadge, nopeBadge) {
      let startX = 0, startY = 0;
      let currentX = 0, currentY = 0;
      let dragging = false;
      const pointerId = { value: null };

      const onDown = (e) => {
        if (pointerId.value !== null) return;
        dragging = true;
        pointerId.value = e.pointerId || 'mouse';
        startX = e.clientX;
        startY = e.clientY;
      };

      const onMove = (e) => {
        if (!dragging || (e.pointerId && e.pointerId !== pointerId.value)) return;
        currentX = e.clientX - startX;
        currentY = e.clientY - startY;
        const rot = currentX / 15;
        card.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rot}deg)`;
        const p = Math.min(1, Math.abs(currentX) / 140);
        likeBadge.style.opacity = String(currentX > 0 ? p : 0);
        nopeBadge.style.opacity = String(currentX < 0 ? p : 0);
      };

      const onUp = async (e) => {
        if (!dragging || (e.pointerId && e.pointerId !== pointerId.value)) return;
        dragging = false;
        pointerId.value = null;
        const threshold = 120;
        if (Math.abs(currentX) > threshold) {
          const likedIt = currentX > 0;
          await fling(card, likedIt);
          recordChoice(src, likedIt);
        } else {
          card.style.transition = 'transform .22s ease';
          card.style.transform = 'translate(0,0) rotate(0)';
          likeBadge.style.opacity = '0';
          nopeBadge.style.opacity = '0';
          await sleep(220);
          card.style.transition = '';
        }
      };

      card.addEventListener('pointerdown', onDown, { passive: true });
      window.addEventListener('pointermove', onMove, { passive: true });
      window.addEventListener('pointerup', onUp, { passive: true });
    }

    async function fling(card, likedIt) {
      const power = 800;
      const angle = likedIt ? 16 : -16;
      card.style.transition = 'transform .28s cubic-bezier(.22,.61,.36,1)';
      card.style.transform = `translate(${likedIt ? power : -power}px, -40px) rotate(${angle}deg)`;
      await sleep(280);
      card.remove();
    }

    function recordChoice(src, likedIt) {
      if (likedIt) liked.push(src); else disliked.push(src);
      index++;
      updateProgress();
      if (index >= photos.length) showSummary();
    }

    function updateProgress() {
      const total = photos.length;
      countEl.textContent = `${index}/${total}`;
      const pct = total ? Math.round((index/total)*100) : 0;
      bar.style.width = pct + '%';
    }

    function bindButtons() {
      likeBtn.onclick = () => trigger('like');
      nopeBtn.onclick = () => trigger('nope');
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') trigger('like');
        else if (e.key === 'ArrowLeft') trigger('nope');
      });
    }

    function topCard() {
      return deck.lastElementChild;
    }

    async function trigger(action) {
      const card = topCard();
      if (!card) return;
      const img = card.querySelector('img');
      const src = img && img.src;
      const likedIt = action === 'like';
      await fling(card, likedIt);
      recordChoice(src, likedIt);
    }

    function showSummary() {
      deck.innerHTML = '';
      summary.style.display = 'block';
      const total = liked.length + disliked.length;
      resultTitle.textContent = `You liked ${liked.length} of ${total} cats`;
      resultText.textContent = liked.length
        ? 'Here are the ones you liked.'
        : 'Zero liked. Refresh for a different energy.';

      likedGrid.innerHTML = '';
      liked.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = 'A liked cat photo';
        likedGrid.appendChild(img);
      });

      tryAgain.onclick = () => load();
    }

    load();
  </script>
</body>
</html>
